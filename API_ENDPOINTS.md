# API 엔드포인트 문서

본 문서는 시놉시스 기반 영상 제작 자동화 POC 애플리케이션에서 사용하는 API 엔드포인트들의 사양을 정의합니다.

## 1. 시놉시스 분석 및 씬 분할 API

### 엔드포인트
```
POST /api/parse-scenes
```

### 요청 형식
```json
{
  "synopsis": "시놉시스 전체 텍스트",
  "scene_count": 10 // 원하는 씬 개수 (5-20 사이)
}
```

### 응답 형식
```json
[
  {
    "id": 1,
    "text": "첫번째 씬 내용",
    "order": 1
  },
  {
    "id": 2,
    "text": "두번째 씬 내용",
    "order": 2
  },
  ...
]
```

### 설명
- 사용자가 입력한 시놉시스를 분석하여 지정된 개수의 씬으로 분할합니다.
- 각 씬은 고유 ID, 텍스트 내용, 순서 번호를 포함합니다.
- 이 API는 OpenAI API를 사용하여 자연어 처리를 통해 시놉시스를 의미 있는 씬으로 나누게 됩니다.

---

## 2. 이미지 프롬프트 생성 API

### 엔드포인트
```
POST /api/generate-image-prompt
```

### 요청 형식
```json
{
  "scene_text": "씬 내용 텍스트"
}
```

### 응답 형식
```json
{
  "prompt": "이미지 생성을 위한 프롬프트 텍스트"
}
```

### 설명
- 각 씬의 텍스트 내용을 분석하여 이미지 생성에 적합한 프롬프트를 생성합니다.
- 생성된 프롬프트는 씬의 주요 요소와 시각적 스타일을 포함해야 합니다.
- 씬의 분위기, 배경, 인물, 액션 등을 고려하여 프롬프트를 작성합니다.

---

## 3. 이미지 생성 API

### 엔드포인트
```
POST /api/generate-images
```

### 요청 형식
```json
{
  "prompt": "이미지 생성 프롬프트"
}
```

### 응답 형식
```json
{
  "images": [
    "이미지1의 URL 또는 Base64 인코딩된 문자열",
    "이미지2의 URL 또는 Base64 인코딩된 문자열",
    "이미지3의 URL 또는 Base64 인코딩된 문자열"
  ]
}
```

### 설명
- 제공된 프롬프트를 기반으로 여러 이미지 후보를 생성합니다.
- 이 API는 DALL-E, Stable Diffusion 또는 Midjourney와 같은 이미지 생성 모델을 사용할 수 있습니다.
- 생성된 이미지는 URL 형태 또는 Base64 인코딩된 문자열로 반환될 수 있습니다.
- 기본적으로 각 요청당 3개의 이미지 후보를 반환하는 것이 권장됩니다.

---

## 4. 이미지 분석 및 영상 프롬프트 생성 API

### 엔드포인트
```
POST /api/describe-image
```

### 요청 형식
```json
{
  "image_url": "선택된 이미지의 URL 또는 Base64 인코딩된 문자열"
}
```

### 응답 형식
```json
{
  "video_prompt": "영상 생성을 위한 프롬프트 텍스트",
  "negative_prompt": "영상 생성 시 제외할 요소를 정의한 네거티브 프롬프트"
}
```

### 설명
- 선택된 이미지를 분석하여 영상 생성에 적합한 프롬프트와 네거티브 프롬프트를 생성합니다.
- 비디오 프롬프트는 이미지의 주요 요소와 움직임, 카메라 각도, 조명 등을 포함해야 합니다.
- 네거티브 프롬프트는 영상 생성 시 피해야 할 요소(저품질, 흐림, 왜곡 등)를 명시합니다.
- 이 API는 GPT-4 Vision과 같은 이미지 분석 기능이 있는 AI 모델을 활용할 수 있습니다.

---

## 구현 요구사항

1. 각 API 엔드포인트는 RESTful 원칙을 따라야 합니다.
2. 모든 요청 및 응답의 내용 유형은 `application/json`이어야 합니다.
3. 오류 발생 시, 적절한 HTTP 상태 코드와 오류 메시지를 반환해야 합니다.
4. API 키 또는 인증 메커니즘을 구현하여 무단 접근을 방지해야 합니다.
5. 요청 및 응답 데이터의 유효성을 검사해야 합니다.

---

## 핵심 API 의존성

위의 API 엔드포인트를 구현하기 위해 다음과 같은 외부 API를 사용할 수 있습니다:

1. **OpenAI API**: 시놉시스 분석, 씬 분할, 이미지 프롬프트 생성, 이미지 분석 등에 활용
   - GPT-4 또는 GPT-4o 모델: 텍스트 기반 프롬프트 및 분석
   - DALL-E 3: 이미지 생성
   - GPT-4 Vision: 이미지 분석 및 비디오 프롬프트 생성

2. **Stable Diffusion API** (대안): 이미지 생성에 활용할 수 있는 대안 API

3. **Midjourney API** (대안): 고품질 이미지 생성을 위한 또 다른 대안

---

## 서버 구현 방법

1. 위의 엔드포인트들을 `server/routes.ts` 파일에 구현합니다.
2. 필요한 스키마 유효성 검사를 `shared/schema.ts`에 정의합니다.
3. OpenAI API 연동을 위한 코드는 별도의 서비스 모듈로 분리하여 관리합니다.
4. 적절한 오류 처리 및 로깅을 구현합니다.

---

API 구현 관련 질문이나 수정 사항이 있으시면 알려주세요.